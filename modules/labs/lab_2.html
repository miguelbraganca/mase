<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>General introduction &mdash; MASE 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=92fd9be5" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=d45e8c67"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            MASE
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../documentation/getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../documentation/tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../documentation/roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../documentation/specifications.html">Coding Style Specifications</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Machop API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/actions.html">Chop Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/passes.html">Chop Passes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/ir.html">IR</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Mase Components</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../hardware/hardware_documentation.html">Hardware Documentation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Students</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../labs.html">Advanced Deep Learning Systems Labs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">MASE</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">General introduction</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/modules/labs/lab_2.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <!-- # Lab 1 for Advanced Deep Learning Systems (ADLS ELEC70109/EE9-AML3-10/EE9-AO25) -->
<br />
<div align="center">
  <a href="https://deepwok.github.io/">
    <img src="../imgs/deepwok.png" alt="Logo" width="160" height="160">
  </a>
  <h1 align="center">Lab 2 for Advanced Deep Learning Systems (ADLS)</h1>
  <p align="center">
    ELEC70109/EE9-AML3-10/EE9-AO25
    <br />
  Written by
    <a href="https://aaron-zhao123.github.io/">Aaron Zhao </a>
  </p>
</div>
<section class="tex2jax_ignore mathjax_ignore" id="general-introduction">
<h1>General introduction<a class="headerlink" href="#general-introduction" title="Link to this heading"></a></h1>
<p>In this lab, you will learn how to use analysis and transform pass system in the software stack of MASE.</p>
<p>There are in total 7 tasks you would need to finish, and also 1 optional task.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="turning-you-network-to-a-graph">
<h1>Turning you network to a graph<a class="headerlink" href="#turning-you-network-to-a-graph" title="Link to this heading"></a></h1>
<p>One specific feature of MASE is its capability to transform DL models to a computation graph using the <a class="reference external" href="https://pytorch.org/docs/stable/fx.html">torch.fx</a> framework.</p>
<p>In this section, we will look at how to transform a model to a <code class="docutils literal notranslate"><span class="pre">MASEGraph</span></code>, starting from the <a class="reference internal" href="#./lab2_transform_no_CLI.ipynb"><span class="xref myst">Notebook</span></a>.</p>
<p>Once you finished the notebook, consider the following problems:</p>
<ol class="arabic simple">
<li><p>Explain the functionality of <code class="docutils literal notranslate"><span class="pre">report_graph_analysis_pass</span></code> and its printed jargons such as <code class="docutils literal notranslate"><span class="pre">placeholder</span></code>, <code class="docutils literal notranslate"><span class="pre">get_attr</span></code> … You might find the doc of <a class="reference external" href="https://pytorch.org/docs/stable/fx.html">torch.fx</a> useful.</p></li>
<li><p>What are the functionalities of <code class="docutils literal notranslate"><span class="pre">profile_statistics_analysis_pass</span></code> and <code class="docutils literal notranslate"><span class="pre">report_node_meta_param_analysis_pass</span></code> respectively?</p></li>
</ol>
<section id="mase-ops-and-mase-types">
<h2>MASE OPs and MASE Types<a class="headerlink" href="#mase-ops-and-mase-types" title="Link to this heading"></a></h2>
<p>MASE is designed to be a very high-level intermediate representation (IR), this is very different from the classic <a class="reference external" href="https://llvm.org/docs/LangRef.html">LLVM IR</a> that you might be familiar with.</p>
<p>The following MASE Types are available:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">module_related_func</span></code>: MASE module_realted_func includes functions under <code class="docutils literal notranslate"><span class="pre">torch.nn.functional</span></code> and the <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> that wrapps them. For example, <code class="docutils literal notranslate"><span class="pre">torch.nn.functional.relu</span></code> and <code class="docutils literal notranslate"><span class="pre">torch.nn.ReLU</span></code> are both MASE module_related_func.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">module</span></code>: a MASE module is a subclass of <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> that does not have corresponding <code class="docutils literal notranslate"><span class="pre">torch.nn.functional</span></code> counterpart. For example, <code class="docutils literal notranslate"><span class="pre">torch.nn.BatchNorm2D</span></code> is a MASE module because <code class="docutils literal notranslate"><span class="pre">torch.nn.functional.batch_norm_2d</span></code> does not exist.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">builtin_func</span></code>: MASE builtin_func includes functions under <code class="docutils literal notranslate"><span class="pre">torch</span></code> that are not <code class="docutils literal notranslate"><span class="pre">torch.nn.functional</span></code> and <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>. For example, <code class="docutils literal notranslate"><span class="pre">torch.cat</span></code> and <code class="docutils literal notranslate"><span class="pre">torch.bmm</span></code> are both MASE builtin_func.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">placeholder</span></code>: a MASE placeholder is the input node of a MASEGraph, i.e., a proxy of input tensor to the network. This type inherits from torch.fx.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">get_attr</span></code>: a MASE get_attr is a node that represents the attribute of a MASE module. This type inherits from torch.fx. An example is <code class="docutils literal notranslate"><span class="pre">self.scale</span> <span class="pre">*</span> <span class="pre">x</span></code> in a <code class="docutils literal notranslate"><span class="pre">forward</span></code> function where <code class="docutils literal notranslate"><span class="pre">self.scale</span></code> is user-defined <code class="docutils literal notranslate"><span class="pre">torch.nn.Parameter</span></code> and <code class="docutils literal notranslate"><span class="pre">x</span></code> is an intermediate tensor.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">output</span></code>: a MASE output is the output node of a MASEGraph, i.e., a proxy of output tensor to the network. This type also inherits from torch.fx.</p></li>
</ul>
<p>You may find more clue in the <a class="reference internal" href="#../../machop/chop/passes/common.py"><span class="xref myst">this file</span></a>.</p>
</section>
<section id="a-deeper-dive-into-the-quantisation-transform">
<h2>A deeper dive into the quantisation transform<a class="headerlink" href="#a-deeper-dive-into-the-quantisation-transform" title="Link to this heading"></a></h2>
<ol class="arabic simple" start="3">
<li><p>Explain why only 1 OP is changed after the <code class="docutils literal notranslate"><span class="pre">quantize_transform_pass</span></code> .</p></li>
<li><p>Write some code to traverse both <code class="docutils literal notranslate"><span class="pre">mg</span></code> and <code class="docutils literal notranslate"><span class="pre">ori_mg</span></code>, check and comment on the nodes in these two graphs. You might find the source code for the implementation of <code class="docutils literal notranslate"><span class="pre">summarize_quantization_analysis_pass</span></code> useful.</p></li>
<li><p>Perform the same quantisation flow to the bigger JSC network that you have trained in lab1. You must be aware that now the <code class="docutils literal notranslate"><span class="pre">pass_args</span></code> for your custom network might be different if you have used more than the <code class="docutils literal notranslate"><span class="pre">Linear</span></code> layer in your network.</p></li>
<li><p>Write code to show and verify that the weights of these layers are indeed quantised. You might need to go through the source code of the implementation of the quantisation pass and also the implementation of the <a class="reference internal" href="#../../machop/chop/passes/transforms/quantize/quantized_modules/linear.py"><span class="xref myst">Quantized Layers</span></a> .</p></li>
</ol>
</section>
<section id="the-command-line-interface">
<h2>The command line interface<a class="headerlink" href="#the-command-line-interface" title="Link to this heading"></a></h2>
<p>The same flow can also be executed on the command line throw the <code class="docutils literal notranslate"><span class="pre">transform</span></code> action.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># make sure you have the same printout</span>
<span class="nb">pwd</span>
<span class="c1"># it should show</span>
<span class="c1"># your_dir/mase-tools/machop</span>

<span class="c1"># enter the following command</span>
./ch<span class="w"> </span>transform<span class="w"> </span>--config<span class="w"> </span>configs/examples/jsc_toy_by_type.toml<span class="w"> </span>--task<span class="w"> </span>cls<span class="w"> </span>--cpu<span class="o">=</span><span class="m">0</span>
</pre></div>
</div>
<ol class="arabic simple" start="7">
<li><p>Load your own pre-trained JSC network, and perform perform the quantisation using the command line interface.</p></li>
</ol>
</section>
<section id="optional-task-write-your-own-pass">
<h2>Optional Task: Write your own pass<a class="headerlink" href="#optional-task-write-your-own-pass" title="Link to this heading"></a></h2>
<p>Many examples of existing passes are in the <a class="reference internal" href="#../..//machop/chop/passes/__init__.py"><span class="xref myst">source code</span></a>, the <a class="reference internal" href="#../../machop/test/passes"><span class="xref myst">test files</span></a> for these passes also contain useful information on helping you to understand how these passes are used.</p>
<p>Implement a pass to count the number of FLOPs (floating-point operations) and BitOPs (bit-wise operations).</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, DeepWok.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>